masterplan.md

# Masterplan: DevHub - Escrit√≥rio Virtual Isom√©trico

## 1. Vis√£o Geral
O **DevHub** √© um ambiente virtual multiplayer 2.5D isom√©trico que simula um escrit√≥rio de tecnologia moderno. O objetivo √© humanizar o trabalho remoto, permitindo que equipes interajam de forma espont√¢nea atrav√©s de movimenta√ß√£o de avatares e chat de v√≠deo/√°udio baseado em proximidade (estilo Gather.town).

## 2. P√∫blico-Alvo
* Equipes de desenvolvimento remotas.
* Comunidades de tecnologia e estudantes.
* Empresas buscando alternativas ao Zoom/Meet para o dia a dia.

## 3. Funcionalidades Principais (MVP)
* **Mundo Isom√©trico:** Renderiza√ß√£o de mapas tiled com colis√£o (paredes, m√≥veis).
* **Multiplayer em Tempo Real:** Visualiza√ß√£o e movimenta√ß√£o de outros usu√°rios sincronizada.
* **Chat de Proximidade:** Conex√£o P2P de v√≠deo/√°udio autom√°tica ao aproximar-se de outro avatar.
* **Autentica√ß√£o e Perfil:** Login seguro e persist√™ncia de dados do usu√°rio (skin, nome).
* **Interface Bil√≠ngue:** Suporte a Portugu√™s e Ingl√™s.

## 4. Stack Tecnol√≥gica
* **Frontend:** TypeScript, Vite, Phaser 3 (Game Engine).
* **Backend:** Node.js, Express (Servidor HTTP).
* **Real-time:** Socket.io (Sincroniza√ß√£o de estado), PeerJS (WebRTC para m√≠dia).
* **Banco de Dados & Auth:** Supabase.
* **Infraestrutura:** Replit.

## 5. Estrat√©gia de Desenvolvimento
Foco na arquitetura "Client-Authoritative" para movimento (para responsividade) com valida√ß√£o b√°sica no server, e arquitetura P2P (Peer-to-Peer) para o streaming de v√≠deo para reduzir custos de servidor.

implementation-plan.md
# Plano de Implementa√ß√£o: DevHub

## Fase 1: Setup do Ambiente (Replit)
- [ ] Inicializar projeto Node.js com TypeScript e Vite.
- [ ] Configurar `package.json` com depend√™ncias:
    - `phaser`, `socket.io-client`, `peerjs`, `@supabase/supabase-js` (Client).
    - `express`, `socket.io`, `peer` (Server).
    - `typescript`, `vite`, `ts-node`, `nodemon` (Dev).
- [ ] Configurar script de build/start para rodar Frontend (Vite) e Backend (Express) simultaneamente ou via proxy.
- [ ] Configurar projeto no Supabase e obter chaves de API (`SUPABASE_URL`, `SUPABASE_ANON_KEY`).

## Fase 2: Integra√ß√£o Supabase (Auth)
- [ ] Criar tela de Login/Registro HTML/CSS simples (sobreposta ao canvas do jogo).
- [ ] Implementar fluxo de autentica√ß√£o com Supabase (Email/Password ou OAuth).
- [ ] Criar tabela `profiles` no Supabase para armazenar posi√ß√£o X,Y inicial e Skin ID.

## Fase 3: Core do Phaser (Game Loop)
- [ ] Configurar `GameScene.ts`.
- [ ] Carregar Assets (Tileset isom√©trico e Sprites de personagens).
- [ ] Implementar renderiza√ß√£o do Mapa (JSON Tiled export).
- [ ] Implementar Player Controller (Input WASD -> Movimento Isom√©trico).
- [ ] Adicionar colis√£o b√°sica com camadas do mapa.

## Fase 4: Multiplayer (Socket.io)
- [ ] Configurar servidor Socket.io b√°sico.
- [ ] **Client:** Emitir evento `playerMovement` ao andar.
- [ ] **Server:** Receber movimento e transmitir `playerMoved` para outros clientes.
- [ ] **Client:** Gerenciar lista de `otherPlayers` (adicionar/remover sprites ao conectar/desconectar).

## Fase 5: Chat de Proximidade (PeerJS)
- [ ] Inicializar PeerJS no cliente (gerar Peer ID √∫nico).
- [ ] Associar Socket ID ao Peer ID.
- [ ] **L√≥gica de Proximidade (Update Loop):**
    - Calcular dist√¢ncia euclidiana entre Player Local e Outros Jogadores.
    - Se `distancia < Threshold` (ex: 150px) -> Iniciar chamada `peer.call()`.
    - Se `distancia > Threshold` -> Fechar chamada.
- [ ] Renderizar streams de v√≠deo em elementos DOM flutuantes acima dos avatares ou em uma barra lateral.

## Fase 6: Polimento e UI
- [ ] Adicionar seletor de idioma (PT/EN).
- [ ] Ajustar assets visuais (sombras, sobreposi√ß√£o correta isocline).
- [ ] Teste de carga b√°sico no Replit.


design-guidelines.md
# Diretrizes de Design e UX: DevHub

## 1. Estilo Visual
* **Perspectiva:** Isom√©trica 2.5D (Top-down diagonal).
* **Tema:** "Dark Mode Tech Office". Ambiente noturno ou interior com ilumina√ß√£o artificial suave.
* **Arte:** Vetor Flat Moderno. Linhas limpas, sem ru√≠do excessivo.
* **Paleta de Cores:**
    * *Fundo/Piso:* Cinza Escuro (#2c3e50), Madeira Clara (#d35400 - accents), Asfalto (#34495e).
    * *UI:* Preto transl√∫cido com bordas neon (Azul ou Verde) para indicar status online.
    * *Destaques:* Verde vibrante para plantas e status "Online".

## 2. Assets (Refer√™ncia para Gera√ß√£o IA)
* **Tileset:** Seamless, conect√°vel. Pisos de carpete de escrit√≥rio, divis√≥rias de vidro, paredes de concreto.
* **Objetos:** Mesas em L pretas, cadeiras gamer, monitores duplos, plantas em vasos de concreto.
* **Avatares:** Estilo "Low poly" ou "Flat Vector", diferenciados por cor da roupa.

## 3. Experi√™ncia do Usu√°rio (UX)
* **Movimenta√ß√£o:** Teclas WASD ou Setas. A resposta deve ser imediata.
* **Feedback de Proximidade:**
    * Ao entrar no raio de outro usu√°rio, um anel visual ou √≠cone deve aparecer indicando "Conectando √Åudio...".
    * O volume do √°udio pode ser espacial (diminui conforme se afasta), se poss√≠vel implementar.
* **Interface (HUD):** Minimalista. Apenas bot√µes de Mute (Mic/C√¢m) e Configura√ß√µes vis√≠veis.

## 4. Internacionaliza√ß√£o
* Textos de UI devem ser carregados de um arquivo JSON de tradu√ß√£o (`pt-br.json`, `en-us.json`) baseados na escolha do usu√°rio.

app-flow-pages-and-roles.md

# Fluxo do App, P√°ginas e Pap√©is

## 1. Pap√©is de Usu√°rio (Roles)
* **Visitante:** Usu√°rio n√£o logado. Acesso restrito apenas √† tela de Login.
* **Membro (Dev):** Usu√°rio logado. Pode andar, interagir e usar v√≠deo/√°udio.
* **Admin (Futuro):** Pode kickar usu√°rios ou modificar o mapa (feature futura).

## 2. Estrutura de P√°ginas (Views)
Como √© um SPA (Single Page Application) com Canvas, as "p√°ginas" s√£o estados da aplica√ß√£o:

1.  **Landing / Auth Layer (HTML Overlay)**
    * Formul√°rio de Login/Cadastro (Supabase).
    * Logo "DevHub".
2.  **Lobby / Character Select (HTML Overlay)**
    * Escolha de cor do Avatar/Nome.
    * Bot√£o "Entrar no Escrit√≥rio".
3.  **Game World (Canvas Phaser)**
    * O escrit√≥rio principal.
    * HUD (Heads-up Display): Bot√µes de microfone, c√¢mera e chat de texto.

## 3. Fluxo do Usu√°rio
1.  **Acesso:** Usu√°rio abre a URL do Replit.
2.  **Auth:** Verifica sess√£o Supabase. Se n√£o existir -> Mostra Login.
3.  **Setup:** Usu√°rio define permiss√µes de C√¢mera/Mic no navegador.
4.  **Spawn:** Avatar aparece em um ponto de spawn predefinido no mapa.
5.  **Intera√ß√£o:**
    * Usu√°rio anda at√© uma mesa.
    * Encontra colega -> V√≠deo abre automaticamente.
    * Conversam.
    * Usu√°rio se afasta -> V√≠deo fecha.
6.  **Sa√≠da:** Usu√°rio fecha a aba (Socket desconecta, Peer destr√≥i).

. package.json
Este arquivo define todas as depend√™ncias e o script para rodar tudo junto.

O que fazer: Crie um arquivo chamado package.json na raiz e cole o conte√∫do abaixo.

JSON

{
  "name": "devhub-mvp",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "concurrently \"npm run server\" \"vite\"",
    "server": "nodemon server/index.js",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.39.0",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "peer": "^1.0.0",
    "peerjs": "^1.5.1",
    "phaser": "^3.70.0",
    "socket.io": "^4.7.2",
    "socket.io-client": "^4.7.2"
  },
  "devDependencies": {
    "concurrently": "^8.2.2",
    "nodemon": "^3.0.2",
    "typescript": "^5.2.2",
    "vite": "^5.0.0"
  }
}
2. server/index.js
Este √© o c√©rebro do backend. Ele configura o Express, o Socket.io (para movimento) e o PeerServer (para v√≠deo) na mesma porta.

O que fazer: Crie uma pasta chamada server e dentro dela um arquivo index.js.

JavaScript

import express from 'express';
import { createServer } from 'http';
import { Server } from 'socket.io';
import { ExpressPeerServer } from 'peer';
import cors from 'cors';
import 'dotenv/config';

const app = express();
const httpServer = createServer(app);
const PORT = process.env.PORT || 3000;

// Configura√ß√£o de CORS (Permitir que o Vite acesse o Backend)
app.use(cors());

// Setup do PeerServer (Sinaliza√ß√£o para V√≠deo/√Åudio)
// Acess√≠vel em /peerjs
const peerServer = ExpressPeerServer(httpServer, {
  debug: true,
  path: '/'
});
app.use('/peerjs', peerServer);

// Setup do Socket.io (Sinaliza√ß√£o para Movimento/Estado)
const io = new Server(httpServer, {
  cors: {
    origin: "*", // Em produ√ß√£o, restrinja isso para a URL do seu app
    methods: ["GET", "POST"]
  }
});

// Estado em mem√≥ria (para o MVP)
const players = {};

io.on('connection', (socket) => {
  console.log(`‚ö° Usu√°rio conectado: ${socket.id}`);

  // Quando um jogador entra, cria um registro b√°sico
  players[socket.id] = {
    x: 400, // Posi√ß√£o inicial padr√£o
    y: 300,
    playerId: socket.id
  };

  // Envia a lista de jogadores atuais para o novo conectado
  socket.emit('currentPlayers', players);

  // Avisa os outros que um novo jogador entrou
  socket.broadcast.emit('newPlayer', players[socket.id]);

  // Recebe movimento do cliente
  socket.on('playerMovement', (movementData) => {
    if (players[socket.id]) {
      players[socket.id].x = movementData.x;
      players[socket.id].y = movementData.y;
      
      // Retransmite a nova posi√ß√£o para todos, exceto o remetente
      socket.broadcast.emit('playerMoved', players[socket.id]);
    }
  });

  // Gerencia desconex√£o
  socket.on('disconnect', () => {
    console.log(`üëã Usu√°rio desconectou: ${socket.id}`);
    delete players[socket.id];
    io.emit('playerDisconnected', socket.id);
  });
});

// Rota de teste
app.get('/', (req, res) => {
  res.send('DevHub Server is Running! üöÄ');
});

// Inicia o servidor
httpServer.listen(PORT, () => {
  console.log(`üöÄ Servidor rodando na porta ${PORT}`);
  console.log(`üìπ PeerServer dispon√≠vel em /peerjs`);
});
3. Configura√ß√£o Extra: vite.config.js
Para garantir que o Frontend (Vite) consiga falar com o Backend no Replit sem erros de porta, crie um arquivo vite.config.js na raiz:

JavaScript

import { defineConfig } from 'vite';

export default defineConfig({
  server: {
    proxy: {
      '/socket.io': {
        target: 'http://localhost:3000',
        ws: true
      },
      '/peerjs': {
        target: 'http://localhost:3000',
        ws: true
      }
    }
  }
});
üìù Pr√≥ximo Passo Sugerido
Agora voc√™ precisa instalar as depend√™ncias. No terminal do Replit (Shell), rode:

Bash

npm install
Depois de instalar, se voc√™ clicar em "Run", o Replit deve tentar rodar o script dev e voc√™ ver√° no console: üöÄ Servidor rodando na porta 3000


index.html
O Vite precisa de um ponto de entrada HTML na raiz do projeto para carregar o script.

O que fazer: Crie o arquivo index.html na raiz do projeto (fora da pasta src).

HTML

<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DevHub - Virtual Office</title>
    <style>
      body { margin: 0; overflow: hidden; background-color: #2c3e50; }
      canvas { display: block; }
    </style>
  </head>
  <body>
    <div id="game-container"></div>
    
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
2. src/main.ts
Este arquivo inicializa o Phaser. Configura a resolu√ß√£o, f√≠sica e carrega a cena principal.

O que fazer: Crie a pasta src e o arquivo main.ts dentro dela.

TypeScript

import Phaser from 'phaser';
import GameScene from './scenes/GameScene';

const config: Phaser.Types.Core.GameConfig = {
  type: Phaser.AUTO, // Usa WebGL por padr√£o
  width: window.innerWidth,
  height: window.innerHeight,
  parent: 'game-container', // ID da div no HTML
  backgroundColor: '#2c3e50', // Cor de fundo do escrit√≥rio (Dark Mode)
  pixelArt: true, // Importante para assets isom√©tricos/pixel art ficarem n√≠tidos
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 0 }, // Sem gravidade (top-down)
      debug: true // Mostra caixas de colis√£o (√∫til para dev)
    }
  },
  scene: [GameScene]
};

// Inicia o jogo
new Phaser.Game(config);
3. src/scenes/GameScene.ts
Aqui √© onde a m√°gica acontece. Eu adicionei placeholders (quadrados coloridos) para voc√™ testar a movimenta√ß√£o multiplayer imediatamente, mesmo sem ter subido os assets gr√°ficos ainda.

O que fazer: Crie a pasta src/scenes e o arquivo GameScene.ts dentro dela.

TypeScript

import Phaser from 'phaser';
import { io, Socket } from 'socket.io-client';

export default class GameScene extends Phaser.Scene {
  private socket: Socket;
  private player: Phaser.Types.Physics.Arcade.SpriteWithDynamicBody | undefined;
  private otherPlayers: Phaser.Physics.Arcade.Group | undefined;
  private cursors: Phaser.Types.Input.Keyboard.CursorKeys | undefined;
  private isConnected: boolean = false;

  constructor() {
    super('GameScene');
  }

  preload() {
    // AQUI: Carregar√≠amos os assets reais (tileset, sprites).
    // Como ainda n√£o temos, vamos criar gr√°ficos "on the fly" no create().
  }

  create() {
    // 1. Configurar Grupo de Outros Jogadores
    this.otherPlayers = this.physics.add.group();

    // 2. Conectar ao Socket.io
    // Nota: No Replit, a conex√£o √© autom√°tica na mesma URL
    this.socket = io(); 

    this.socket.on('connect', () => {
      console.log('‚úÖ Conectado ao servidor Socket.io!');
      this.isConnected = true;
    });

    // 3. Gerenciar Eventos de Multiplayer
    
    // Recebe a lista de jogadores atuais ao entrar
    this.socket.on('currentPlayers', (players: any) => {
      Object.keys(players).forEach((id) => {
        if (players[id].playerId === this.socket.id) {
          this.createMyPlayer(players[id]);
        } else {
          this.addOtherPlayer(players[id]);
        }
      });
    });

    // Novo jogador entrou
    this.socket.on('newPlayer', (playerInfo: any) => {
      this.addOtherPlayer(playerInfo);
    });

    // Jogador desconectou
    this.socket.on('playerDisconnected', (playerId: string) => {
      this.otherPlayers?.getChildren().forEach((otherPlayer: any) => {
        if (playerId === otherPlayer.playerId) {
          otherPlayer.destroy();
        }
      });
    });

    // Jogador se moveu
    this.socket.on('playerMoved', (playerInfo: any) => {
      this.otherPlayers?.getChildren().forEach((otherPlayer: any) => {
        if (playerInfo.playerId === otherPlayer.playerId) {
          otherPlayer.setPosition(playerInfo.x, playerInfo.y);
        }
      });
    });

    // 4. Controles (Setas do teclado)
    if (this.input.keyboard) {
        this.cursors = this.input.keyboard.createCursorKeys();
    }
  }

  update() {
    // S√≥ processa se o jogador j√° foi criado e est√° conectado
    if (!this.player || !this.cursors || !this.isConnected) return;

    // Reseta velocidade
    this.player.setVelocity(0);
    const speed = 200;
    let moved = false;

    // L√≥gica de Movimento (B√°sica 2D - depois mudaremos para Isom√©trico real)
    if (this.cursors.left.isDown) {
      this.player.setVelocityX(-speed);
      moved = true;
    } else if (this.cursors.right.isDown) {
      this.player.setVelocityX(speed);
      moved = true;
    }

    if (this.cursors.up.isDown) {
      this.player.setVelocityY(-speed);
      moved = true;
    } else if (this.cursors.down.isDown) {
      this.player.setVelocityY(speed);
      moved = true;
    }

    // Se houve movimento, envia para o servidor
    if (moved) {
      this.socket.emit('playerMovement', { 
        x: this.player.x, 
        y: this.player.y 
      });
    }
  }

  // --- Fun√ß√µes Auxiliares ---

  private createMyPlayer(playerInfo: any) {
    // Cria um ret√¢ngulo azul para representar VOC√ä (placeholder)
    const graphics = this.make.graphics({ x: 0, y: 0, add: false });
    graphics.fillStyle(0x0000ff, 1); // Azul
    graphics.fillRect(0, 0, 32, 32);
    graphics.generateTexture('playerTexture', 32, 32);

    this.player = this.physics.add.sprite(playerInfo.x, playerInfo.y, 'playerTexture');
    
    // A c√¢mera segue voc√™
    this.cameras.main.startFollow(this.player);
    this.cameras.main.setZoom(1.5); // Zoom para ver melhor
  }

  private addOtherPlayer(playerInfo: any) {
    // Cria um ret√¢ngulo vermelho para OUTROS (placeholder)
    if (!this.textures.exists('otherPlayerTexture')) {
        const graphics = this.make.graphics({ x: 0, y: 0, add: false });
        graphics.fillStyle(0xff0000, 1); // Vermelho
        graphics.fillRect(0, 0, 32, 32);
        graphics.generateTexture('otherPlayerTexture', 32, 32);
    }

    const otherPlayer: any = this.physics.add.sprite(playerInfo.x, playerInfo.y, 'otherPlayerTexture');
    otherPlayer.playerId = playerInfo.playerId;
    this.otherPlayers?.add(otherPlayer);
  }
}
üöÄ Hora de Testar!
Certifique-se de que todos os arquivos est√£o salvos.

No Shell do Replit, pare o processo anterior (Ctrl+C) e rode novamente:

Bash

npm run dev
Abra a janela "Webview" do Replit (ou a aba nova).

O Teste de Ouro: Abra o link do projeto em duas abas diferentes do navegador.

Mova o quadrado azul em uma aba e veja se o quadrado vermelho se mexe na outra.

Se funcionar, parab√©ns! Voc√™ tem a infraestrutura multiplayer em tempo real rodando. üéâ

